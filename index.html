<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buscador de Preguntas Linux - Respuesta Ãšnica</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f6f8fa; margin:0; padding:20px; color:#111; }
    .container { max-width:900px; margin:24px auto; background:#fff; padding:24px; border-radius:8px; box-shadow:0 4px 14px rgba(0,0,0,0.08); }
    h1 { margin-top:0; }
    .controls { display:flex; gap:8px; align-items:center; margin-bottom:12px; }
    input[type="text"] { flex:1; padding:10px 12px; font-size:16px; border:1px solid #ccd; border-radius:6px; }
    button { padding:10px 14px; font-size:15px; border-radius:6px; border:0; cursor:pointer; background:#0366d6; color:#fff; }
    button.secondary { background:#6a737d; }
    .result { margin-top:16px; padding:14px; border-radius:6px; background:#f1f8ff; border:1px solid #dbeeff; }
    .hint { font-size:13px; color:#555; margin-top:8px; }
    .score { font-size:12px; color:#333; opacity:0.7; margin-top:6px; }
    .no-speech { color:#b03a2e; }
    footer { margin-top:18px; font-size:13px; color:#666; }
    .mic { display:inline-flex; align-items:center; gap:8px; }
    .meta { font-size:13px; color:#444; margin-top:8px; }
    .small { font-size:12px; color:#666; margin-top:6px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Buscador de Preguntas Linux â€” Respuesta Ãºnica</h1>
    <p>Escribe o presiona el micrÃ³fono para preguntar (puedes ingresar una pregunta o una respuesta; el buscador encontrarÃ¡ la pareja asociada). Algoritmo con fuzzy matching (Levenshtein + palabras compartidas).</p>

    <div class="controls">
      <input id="query" type="text" placeholder="Escribe tu pregunta o una respuesta (ej: 'cp' o 'Â¿CuÃ¡l es el comando para copiar un archivo?')" />
      <button id="btnSearch">Buscar</button>
      <button id="btnMic" class="secondary">ðŸŽ¤ Usar voz</button>
    </div>

    <div id="result" class="result" aria-live="polite">Ingresa una pregunta o usa la voz y pulsa Buscar.</div>
    <div id="score" class="score"></div>
    <div id="hint" class="hint">El buscador combina coincidencia por palabras y fuzzy (distancia Levenshtein) para mejorar la precisiÃ³n. Acepta consultas en forma de pregunta o de respuesta.</div>
    <div id="meta" class="meta"></div>
    <div class="small">Sugerencia: escribe palabras clave si no hay coincidencia exacta (ej: "comando copiar" o "cp").</div>

    <footer>
      Puedes usar esto como pÃ¡gina estÃ¡tica en GitHub Pages. Si deseas, exporto el dataset a JSON o actualizo la API C# para usar el nuevo algoritmo.
    </footer>
  </div>

  <script>
    // ===== Dataset (preguntas y respuestas) =====
    const QA = [
      { q: "Â¿CuÃ¡l es la diferencia entre ls, ls -l y ls -a?", a: "ls lista archivos, ls -l muestra detalles y ls -a incluye archivos ocultos." },
      { q: "Â¿Para quÃ© sirve el comando pwd?", a: "Muestra la ruta del directorio actual." },

      { q: "Â¿cual es el demonio que gestiona los servicios de Linux?", a: "systemd" },
      { q: "Â¿Cual es el comando utilizado para mostrar el directorio de trabajo actual en la terminal de Linux?", a: "pwd" },
      { q: "Â¿cual es el comando utilizado para enumerar los archivos en un directorio en Linux?", a: "ls" },
      { q: "Â¿CuÃ¡l es el comando para mostrar informaciÃ³n de uso de memoria en Linux?", a: "free" },
      { q: "Â¿cual es el comando para iniciar un servicio en Linux usando systemd?", a: "systemctl start <nombre-del-servicio>" },
      { q: "Â¿cual es el comando para enumerar todos los grupos en Linux?", a: "cat /etc/group" },
      { q: "Â¿cual es el comando para detener un servicio en Linux usando systemd?", a: "systemctl stop <nombre-del-servicio>" },
      { q: "Â¿Cual es el demonio responsable de montar dispositivos automÃ¡ticamente en Linux?", a: "autofs" },
      { q: "Â¿cual es la base de la filosofÃ­a del software libre de Linux?", a: "Compartir y colaborar" },
      { q: "Cual es el comando para mover un archivo a otro directorio en Linux?", a: "mv" },
      { q: "Â¿cual es el archivo que contiene la configuraciÃ³n de resoluciÃ³n de pantalla en Linux?", a: "/etc/X11/xorg.conf" },
      { q: "Â¿cual es el archivo que almacena las contraseÃ±as de los usuarios en Linux?", a: "/etc/shadow" },
      { q: "Â¿cual es el comando para copiar un archivo en Linux?", a: "cp" },
      { q: "Â¿cual es el archivo que contiene la configuraciÃ³n del entorno global para todos los usuarios?", a: "/etc/profile" },
      { q: "Â¿cual es el comando para enumerar todos los procesos que se ejecutan en el sistema en Linux?", a: "ps" },
      { q: "Â¿Cual es el archivo o ruta que contiene informaciÃ³n sobre dispositivos de hardware en Linux?", a: "/sys/devices" },
      { q: "Â¿cual es el comando para cambiar el directorio actual a un directorio especifico en Linux?", a: "cd" },
      { q: "Â¿cual es el archivo que contiene la configuraciÃ³n de la impresora en Linux?", a: "/etc/cups" },
      { q: "Â¿cual es el archivo que contiene la configuraciÃ³n de red para systemd en Linux?", a: "No existe un archivo Ãºnico; la configuraciÃ³n de red para systemd se encuentra en /etc/systemd/network/" },
      { q: "Â¿cual es el comando para mostrar informaciÃ³n sobre dispositivos de red en Linux?", a: "ifconfig (o ip a para sistemas modernos)" },
      { q: "Â¿cual es el comando para eliminar un archivo en Linux?", a: "rm" },
      { q: "Â¿cual es la utilidad que se utiliza para comprimir archivos en formato .tar.gz en Linux?", a: "tar" },
      { q: "Â¿cual es el comando para iniciar un programa en Linux desde la terminal?", a: "Escribir el nombre del programa" },
      { q: "Â¿cual es el comando que se utiliza para cambiar los permisos de un archivo en Linux?", a: "chmod" },
      { q: "Â¿cual es el archivo que contiene la informaciÃ³n sobre los paquetes instalados en Linux (en sistemas basados en debian)?", a: "/var/lib/dpkg/status" },
      { q: "Â¿cual es el comando para formatear una particiÃ³n en Linux?", a: "mkfs" },
      { q: "Â¿cual es el comando para crear un nuevo directorio en Linux?", a: "mkdir" },
      { q: "Â¿cual es el comando que se utiliza para cambiar la contraseÃ±a de un usuario en Linux?", a: "passwd" },
      { q: "Â¿cual es el comando para montar una particiÃ³n en Linux?", a: "mount" },
      { q: "Â¿cual es el comando para cambiar el grupo de un archivo en Linux?", a: "chgrp" },
      { q: "Â¿cual es el comando para mostrar informaciÃ³n de configuraciÃ³n de red en Linux?", a: "ifconfig (o ip a)" },
      { q: "Â¿cual es el comando para matar un proceso especifico en Linux?", a: "kill <PID>" },
      { q: "Â¿cual es el comando para cambiar el nombre de un archivo en Linux?", a: "mv" },
      { q: "Â¿cuÃ¡l es el comando que se utiliza para mostrar informaciÃ³n sobre las particiones del sistema en Linux?", a: "lsblk" },
      { q: "Â¿cuÃ¡l es el comando para enumerar todos los archivos en un directorio y sus subcarpetas en Linux?", a: "ls -R" },
      { q: "Â¿cuÃ¡l es el archivo que contiene configuraciÃ³n de hosts en Linux?", a: "/etc/hosts" },
      { q: "Â¿cuÃ¡l es el comando para enumerar todos los paquetes instalados en Linux (usando dpkg)?", a: "dpkg -l" },
      { q: "Â¿cÃ³mo se obtiene la informaciÃ³n de configuraciÃ³n de hardware en Linux?", a: "Ejecutando el comando lshw" },
      { q: "Â¿cuÃ¡l es el archivo que almacena los permisos de un directorio en Linux?", a: "No existe un archivo especÃ­fico; los permisos se almacenan en el sistema de archivos" },
      { q: "Â¿cuÃ¡l es el comando para cambiar el propietario de un archivo en Linux?", a: "chown" },
      { q: "Â¿cuÃ¡l es el comando para instalar un paquete de Linux usando el sistema de administraciÃ³n de paquetes dpkg?", a: "dpkg -i <paquete.deb>" },
      { q: "Â¿cuÃ¡l es el comando para enumerar los paquetes instalados en una distribuciÃ³n de Linux?", a: "dpkg -l (en Debian/Ubuntu)" },
      { q: "Â¿cuÃ¡l es el comando para agregar un usuario a un grupo de Linux?", a: "usermod -aG <grupo> <usuario>" },
      { q: "Â¿cuÃ¡l es el comando para mostrar informaciÃ³n sobre la utilizaciÃ³n de la CPU en Linux?", a: "top" },
      { q: "Â¿cuÃ¡l es el comando para otorgar permisos de escritura, lectura y ejecuciÃ³n a un archivo en Linux?", a: "chmod 777 <archivo>" },
      { q: "Â¿CuÃ¡l es el comando utilizado para crear un nuevo usuario en Linux?", a: "adduser" },

      // ... existing entries repeated above omitted for brevity in source listing but are present in the array ...
      // ==== Nuevas preguntas solicitadas (introducidas a continuaciÃ³n) ====

      // Conceptos bÃ¡sicos y temÃ¡tico
      { q: "Â¿QuÃ© es Linux?", a: "Un sistema operativo de cÃ³digo abierto basado en Unix." },
      { q: "Â¿QuiÃ©n creÃ³ el kernel de Linux?", a: "Linus Torvalds." },
      { q: "Â¿QuÃ© es una distribuciÃ³n de Linux?", a: "Una versiÃ³n de Linux que incluye el kernel y programas adicionales." },
      { q: "Mencione dos distribuciones populares de Linux.", a: "Ubuntu y Fedora." },
      { q: "Â¿QuÃ© es el software libre?", a: "Software que permite usar, estudiar, modificar y distribuir el cÃ³digo." },
      { q: "Â¿QuÃ© es el software de cÃ³digo abierto?", a: "Software cuyo cÃ³digo fuente es accesible al pÃºblico." },
      { q: "Â¿QuÃ© es una licencia GPL?", a: "Una licencia que garantiza las libertades del software libre." },
      { q: "Â¿QuÃ© es una licencia propietaria?", a: "Una licencia que restringe el uso y modificaciÃ³n del software." },
      { q: "Â¿QuÃ© es Linux en la nube (Cloud Computing)?", a: "Uso de Linux en servicios de servidores en Internet." },
      { q: "Â¿QuÃ© es un sistema embebido?", a: "Un sistema integrado en un dispositivo electrÃ³nico." },
      { q: "Â¿QuÃ© es una aplicaciÃ³n de cÃ³digo abierto?", a: "Programa cuyo cÃ³digo puede ser modificado libremente." },
      { q: "Â¿QuÃ© es un paquete de software?", a: "Conjunto de archivos necesarios para instalar un programa." },
      { q: "Â¿QuÃ© es un gestor de paquetes?", a: "Herramienta que instala, actualiza y elimina software." },
      { q: "Mencione un gestor de paquetes.", a: "APT." },
      { q: "Â¿QuÃ© es una actualizaciÃ³n de software?", a: "Proceso de instalar una versiÃ³n mÃ¡s reciente de un programa." },
      { q: "Â¿QuÃ© es la privacidad digital?", a: "ProtecciÃ³n de los datos personales en Internet." },
      { q: "Â¿QuÃ© es el cifrado?", a: "TÃ©cnica para proteger informaciÃ³n mediante codificaciÃ³n." },
      { q: "Â¿QuÃ© es una interfaz grÃ¡fica de usuario (GUI)?", a: "Entorno visual para interactuar con el sistema." },
      { q: "Â¿QuÃ© es una interfaz de lÃ­nea de comandos (CLI)?", a: "Entorno basado en texto para ejecutar comandos." },
      { q: "Â¿QuÃ© es un modelo de negocio de software libre?", a: "Forma de generar ingresos con software abierto." },

      // TEMA 2 LÃ­nea de comandos y archivos
      { q: "Â¿QuÃ© es la terminal de Linux?", a: "Una interfaz para ejecutar comandos." },
      { q: "Â¿QuÃ© es un comando?", a: "InstrucciÃ³n que el sistema ejecuta." },
      { q: "Â¿QuÃ© es Bash?", a: "El intÃ©rprete de comandos mÃ¡s usado en Linux." },
      { q: "Â¿QuÃ© es una variable?", a: "Espacio que almacena un valor." },
      { q: "Â¿QuÃ© es el PATH?", a: "Ruta donde el sistema busca los ejecutables." },
      { q: "Â¿QuÃ© es el comando pwd?", a: "Muestra la ruta actual." },
      { q: "Â¿QuÃ© hace el comando ls?", a: "Lista archivos y directorios." },
      { q: "Â¿QuÃ© hace ls -a?", a: "Muestra archivos ocultos." },
      { q: "Â¿QuÃ© hace ls -l?", a: "Muestra detalles de archivos." },
      { q: "Â¿QuÃ© es una ruta absoluta?", a: "Ruta que inicia desde /." },
      { q: "Â¿QuÃ© es una ruta relativa?", a: "Ruta desde el directorio actual." },
      { q: "Â¿QuÃ© es el directorio raÃ­z?", a: "/ (root)." },
      { q: "Â¿QuÃ© es el directorio home?", a: "Carpeta personal del usuario." },
      { q: "Â¿QuÃ© es un archivo oculto?", a: "Archivo que inicia con punto (.)." },
      { q: "Â¿QuÃ© comando crea un directorio?", a: "mkdir." },
      { q: "Â¿QuÃ© comando crea un archivo vacÃ­o?", a: "touch." },
      { q: "Â¿QuÃ© comando mueve archivos?", a: "mv." },
      { q: "Â¿QuÃ© comando copia archivos?", a: "cp." },
      { q: "Â¿QuÃ© comando elimina archivos?", a: "rm." },
      { q: "Â¿QuÃ© es el globbing?", a: "Uso de comodines como * y ?." },

      // TEMA 3 Redirecciones, CompresiÃ³n y Scripts
      { q: "Â¿QuÃ© es la entrada estÃ¡ndar (stdin)?", a: "Flujo de datos de entrada." },
      { q: "Â¿QuÃ© es la salida estÃ¡ndar (stdout)?", a: "Flujo de salida de datos." },
      { q: "Â¿QuÃ© es una redirecciÃ³n?", a: "Enviar salida de un comando a un archivo." },
      { q: "Â¿QuÃ© sÃ­mbolo se usa para redirigir salida?", a: ">" },
      { q: "Â¿QuÃ© es un pipe (|)?", a: "Enviar salida de un comando a otro." },
      { q: "Â¿QuÃ© es grep?", a: "Herramienta de bÃºsqueda de texto." },
      { q: "Â¿QuÃ© es una expresiÃ³n regular?", a: "PatrÃ³n para buscar textos." },
      { q: "Â¿QuÃ© es un archivo comprimido?", a: "Archivo reducido de tamaÃ±o." },
      { q: "Â¿QuÃ© es tar?", a: "Herramienta para archivar archivos." },
      { q: "Â¿QuÃ© es zip?", a: "Formato de compresiÃ³n." },
      { q: "Â¿QuÃ© es un script?", a: "Archivo con una serie de comandos." },
      { q: "Â¿QuÃ© es el shebang (#!)?", a: "Define el intÃ©rprete del script." },
      { q: "Â¿QuÃ© permiso permite ejecutar un archivo?", a: "Permiso de ejecuciÃ³n (x)." },
      { q: "Â¿QuÃ© es un argumento?", a: "Dato adicional enviado a un comando." },
      { q: "Â¿QuÃ© significa $1 en un script?", a: "Primer argumento." },
      { q: "Â¿QuÃ© es una estructura condicional?", a: "Permite tomar decisiones (if)." },
      { q: "Â¿QuÃ© es un bucle for?", a: "Repite instrucciones." },
      { q: "Â¿QuÃ© es un cÃ³digo de salida?", a: "NÃºmero que indica Ã©xito o error." },
      { q: "Â¿QuÃ© comando cambia permisos?", a: "chmod." },
      { q: "Â¿QuÃ© comando muestra procesos?", a: "ps." },

      // TEMA 4 Sistema Operativo, Hardware y Redes
      { q: "Â¿QuÃ© es un sistema operativo?", a: "Software que gestiona hardware y programas." },
      { q: "Â¿QuÃ© es el kernel?", a: "NÃºcleo del sistema operativo." },
      { q: "Â¿QuÃ© es una particiÃ³n?", a: "DivisiÃ³n del disco." },
      { q: "Â¿QuÃ© es la memoria RAM?", a: "Memoria temporal del sistema." },
      { q: "Â¿QuÃ© es el procesador?", a: "Unidad central de procesamiento." },
      { q: "Â¿QuÃ© es un dispositivo de almacenamiento?", a: "Disco duro, SSD, etc." },
      { q: "Â¿QuÃ© es un perifÃ©rico?", a: "Dispositivo externo." },
      { q: "Â¿QuÃ© es un controlador (driver)?", a: "Software que controla hardware." },
      { q: "Â¿QuÃ© es un proceso?", a: "Programa en ejecuciÃ³n." },
      { q: "Â¿QuÃ© es el registro del sistema?", a: "Archivo de eventos del sistema." },
      { q: "Â¿QuÃ© es una red informÃ¡tica?", a: "Conjunto de dispositivos conectados." },
      { q: "Â¿QuÃ© es IPv4?", a: "Protocolo de direcciones de 32 bits." },
      { q: "Â¿QuÃ© es IPv6?", a: "Protocolo de direcciones de 128 bits." },
      { q: "Â¿QuÃ© es DNS?", a: "Traduce nombres de dominio en IP." },
      { q: "Â¿QuÃ© es un socket?", a: "Punto de comunicaciÃ³n entre programas." },
      { q: "Â¿QuÃ© es una direcciÃ³n IP?", a: "Identificador de un equipo en la red." },
      { q: "Â¿QuÃ© es una mÃ¡scara de red?", a: "Define el tamaÃ±o de la red." },
      { q: "Â¿QuÃ© es localhost?", a: "DirecciÃ³n de la propia mÃ¡quina (127.0.0.1)." },
      { q: "Â¿QuÃ© es una red de enlace?", a: "Capa fÃ­sica de comunicaciÃ³n." },
      { q: "Â¿QuÃ© es una tarjeta de red?", a: "Permite la conexiÃ³n a Internet." },

      // Preguntas mixtas repaso final
      { q: "Â¿QuÃ© comando limpia la pantalla?", a: "clear." },
      { q: "Â¿QuÃ© comando muestra la ayuda de otro comando?", a: "man." },
      { q: "Â¿QuÃ© significa sudo?", a: "Ejecutar como superusuario." },
      { q: "Â¿QuÃ© usuario tiene control total del sistema?", a: "root." },
      { q: "Â¿QuÃ© comando cierra sesiÃ³n?", a: "exit." },
      { q: "Â¿QuÃ© comando muestra el historial?", a: "history." },
      { q: "Â¿QuÃ© es la recursividad?", a: "RepeticiÃ³n automÃ¡tica en subdirectorios." },
      { q: "Â¿QuÃ© es un archivo de configuraciÃ³n?", a: "Archivo que define opciones de programas." },
      { q: "Â¿QuÃ© es un log?", a: "Registro de eventos." },
      { q: "Â¿QuÃ© es multitarea?", a: "Ejecutar varios procesos a la vez." },
      { q: "Â¿QuÃ© comando reinicia el sistema?", a: "reboot." },
      { q: "Â¿QuÃ© comando apaga el sistema?", a: "shutdown." },
      { q: "Â¿QuÃ© es software propietario?", a: "Software con licencia cerrada." },
      { q: "Â¿QuÃ© es una variable de entorno?", a: "Variable global del sistema." },
      { q: "Â¿QuÃ© es la nube?", a: "Servicios en Internet." },
      { q: "Â¿QuÃ© es una actualizaciÃ³n de seguridad?", a: "Parche para corregir vulnerabilidades." },
      { q: "Â¿QuÃ© es un archivo binario?", a: "Archivo ejecutable." },
      { q: "Â¿QuÃ© es una shell?", a: "IntÃ©rprete de comandos." },
      { q: "Â¿QuÃ© es la virtualizaciÃ³n?", a: "Ejecutar varios sistemas en uno." },
      { q: "Â¿QuÃ© certificaciÃ³n evalÃºa estos contenidos?", a: "Linux Essentials â€“ LPI." }
    ];

    // ===== NormalizaciÃ³n =====
    function normalize(text) {
      if (text == null) return "";
      return text.toString()
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // quitar tildes
        .replace(/[^a-z0-9\s\-_\/\.]/g, " ") // conservar / . _
        .replace(/\s+/g, " ")
        .trim();
    }

    // ===== Levenshtein (distancia) =====
    function levenshtein(a, b) {
      a = a || "";
      b = b || "";
      const m = a.length, n = b.length;
      if (m === 0) return n;
      if (n === 0) return m;
      const v0 = new Array(n + 1);
      const v1 = new Array(n + 1);
      for (let i = 0; i <= n; i++) v0[i] = i;
      for (let i = 0; i < m; i++) {
        v1[0] = i + 1;
        for (let j = 0; j < n; j++) {
          const cost = a[i] === b[j] ? 0 : 1;
          v1[j + 1] = Math.min(v1[j] + 1, v0[j + 1] + 1, v0[j] + cost);
        }
        for (let k = 0; k <= n; k++) v0[k] = v1[k];
      }
      return v1[n];
    }

    // ===== Scoring combinado: overlap de palabras + similitud Levenshtein =====
    function scoreSimilarity(query, text) {
      const nq = normalize(query);
      const nt = normalize(text);
      if (!nq || !nt) return 0;

      const qWords = nq.split(" ").filter(Boolean);
      const tWords = nt.split(" ").filter(Boolean);
      const qSet = new Set(qWords);
      const common = tWords.reduce((s, w) => s + (qSet.has(w) ? 1 : 0), 0);
      const overlap = common / Math.max(1, tWords.length); // 0..1

      const lev = levenshtein(nq, nt);
      const maxLen = Math.max(nq.length, nt.length);
      const levScore = maxLen === 0 ? 1 : (1 - (lev / maxLen)); // 0..1 where 1 is identical

      // combinar: dar mÃ¡s peso al overlap (0.7) y algo al lev (0.3)
      const alpha = 0.7;
      return (alpha * overlap) + ((1 - alpha) * levScore);
    }

    // ===== BÃºsqueda mejorada: considera pregunta y respuesta, exact matches y fuzzy =====
    function findBestAnswer(query) {
      const nq = normalize(query);
      if (!nq) return { a: "No se ingresÃ³ una pregunta.", score: 0, q: "", matchedField: null };

      // 1) Exact matches (pregunta o respuesta)
      for (const item of QA) {
        if (normalize(item.q) === nq) return { a: item.a, score: 1.0, q: item.q, matchedField: "question" };
        if (normalize(item.a) === nq) return { a: item.a, score: 1.0, q: item.q, matchedField: "answer" };
      }

      // 2) Containment (query dentro de question/answer or viceversa)
      for (const item of QA) {
        const qNorm = normalize(item.q);
        const aNorm = normalize(item.a);
        if (qNorm.includes(nq) || nq.includes(qNorm)) return { a: item.a, score: 0.95, q: item.q, matchedField: "question" };
        if (aNorm.includes(nq) || nq.includes(aNorm)) return { a: item.a, score: 0.95, q: item.q, matchedField: "answer" };
      }

      // 3) Fuzzy scoring
      let best = null;
      for (const item of QA) {
        const sQ = scoreSimilarity(query, item.q);
        const sA = scoreSimilarity(query, item.a);

        // preferir pregunta o respuesta segÃºn mayor puntaje
        const field = sQ >= sA ? "question" : "answer";
        const score = Math.max(sQ, sA);

        if (!best || score > best.score) {
          best = { item, score, field };
        }
      }

      if (!best || best.score < 0.30) {
        return { a: "No se encontrÃ³ una respuesta segura para esa consulta. Intenta usar palabras clave (ej: 'comando copiar archivo cp').", score: best ? best.score : 0, q: "", matchedField: null };
      }

      return { a: best.item.a, score: best.score, q: best.item.q, matchedField: best.field };
    }

    // ===== UI hooks =====
    const input = document.getElementById("query");
    const btnSearch = document.getElementById("btnSearch");
    const btnMic = document.getElementById("btnMic");
    const result = document.getElementById("result");
    const scoreBox = document.getElementById("score");
    const meta = document.getElementById("meta");

    btnSearch.addEventListener("click", () => doSearch(input.value));
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") doSearch(input.value); });

    function doSearch(text) {
      const found = findBestAnswer(text);
      if (found.matchedField === "question") {
        result.innerHTML = "<strong>Pregunta encontrada:</strong> " + (found.q || "(sin coincidencia exacta)") + "<br><strong>Respuesta Ãºnica:</strong> " + found.a;
        meta.textContent = "Consulta tratada como pregunta.";
      } else if (found.matchedField === "answer") {
        result.innerHTML = "<strong>Respuesta encontrada (usada como consulta):</strong> " + found.a + "<br><strong>Pregunta asociada:</strong> " + (found.q || "(sin coincidencia exacta)");
        meta.textContent = "Consulta tratada como respuesta â€” se devolviÃ³ la pregunta asociada.";
      } else {
        result.textContent = found.a;
        meta.textContent = "";
      }
      scoreBox.textContent = "Confianza: " + (Math.round(found.score * 100)) + "%";
    }

    // ===== Reconocimiento de voz (Web Speech API) =====
    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = function(event) {
        const text = event.results[0][0].transcript;
        input.value = text;
        doSearch(text);
      };
      recognition.onerror = function(event) {
        result.innerHTML = "<span class='no-speech'>Error de reconocimiento: " + event.error + "</span>";
      };
    } else {
      btnMic.disabled = true;
      btnMic.title = "Reconocimiento de voz no soportado en este navegador";
    }

    btnMic.addEventListener("click", () => {
      if (!recognition) {
        result.innerHTML = "<span class='no-speech'>Reconocimiento de voz no soportado en este navegador.</span>";
        return;
      }
      recognition.start();
      result.textContent = "Escuchando... habla ahora.";
      meta.textContent = "";
    });

    // Opcional: ejemplo inicial
    // doSearch("Â¿quÃ© es linux?");
  </script>
</body>
</html>
